echo
echo "Welcome."
echo

if [ -f ~/.bashrc ]; then
   source ~/.bashrc
fi

is_git_repository() {
  git branch > /dev/null 2>&1
}

get_git_branch() {
    branch_name=$(git symbolic-ref -q HEAD)
    branch_name=${branch_name##refs/heads/}
    branch_name=${branch_name:-HEAD}
    printf $branch_name
}

tput-escaped() {
    # we need to escape it otherwise cursor navigation will get broken:
    # http://superuser.com/questions/207298/mac-terminal-iterm-history-cursor-problems
    echo -n '\['
    tput $@
    echo -n '\]'
}

set_color() {
    tput-escaped setaf $1
}

cprint() {
    set_color $1
    shift
    printf "$@"
}

prompt=" âŒ˜ "

color_black=0
color_red=1
color_green=2
color_yellow=3
color_blue=4
color_magenta=5
color_cyan=6
color_gray=7

print_prompt() {
    relative_pwd=${PWD/~/\~}
    if is_git_repository; then
        git_root=$(git rev-parse --show-toplevel)
        relative_git_root=${git_root/~/\~}
        git_path=${relative_pwd/$relative_git_root/}
        non_git_path=${relative_pwd/$git_path/}
        git_branch=@$(get_git_branch)
    else
        git_path=
        non_git_path=$relative_pwd
        git_branch=
    fi

    cprint $color_blue "%s" "$non_git_path"
    cprint $color_cyan "%s" "$git_branch"
    cprint $color_blue "%s" "$git_path"
    cprint $color_blue "%s" "$prompt"
    tput-escaped sgr0
    tput-escaped bold
}

prompt_func() {
    export PS1=$(print_prompt)
}

export PROMPT_COMMAND=prompt_func
export TERMINAL_RESET=$(echo -en "\033(B\033[m")
trap 'echo -n $TERMINAL_RESET' DEBUG
